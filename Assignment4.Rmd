---
title: "Assignment4"
author: "Gianina Yumul"
date: "9/28/2020"
output: 
  html_document:
    theme: paper
    toc: true
    toc_depth: 3
    toc_float: true
    highlight: tango
    code_folding: hide
    
---

# Assignment Brief

Select between five and 30 locations within a city or metropolitan area. For each location, generate isochrones for the same travel time for at least two different modes. Calculate the area of each isochrone and compare the areas of the isochrones for the two (or more) modes you analyzed. Create three figures (which may or may not be maps) to illustrate the results of your analysis.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Declare libraries while suppressing outputs.
library(osmdata, quietly = TRUE, warn.conflicts = FALSE)
library(opentripplanner, quietly = TRUE, warn.conflicts = FALSE)
library(tidyverse, quietly = TRUE, warn.conflicts = FALSE)
library(sf, quietly = TRUE, warn.conflicts = FALSE)
library(ggthemes, quietly = TRUE, warn.conflicts = FALSE)
library(ggspatial, quietly = TRUE, warn.conflicts = FALSE)
library(wesanderson, quietly = TRUE, warn.conflicts = FALSE)
```

```{r}
bos_police <- st_read("http://bostonopendata-boston.opendata.arcgis.com/datasets/e5a0066d38ac4e2abbc7918197a4f6af_6.kml?outSR=%7B%22latestWkid%22%3A2249%2C%22wkid%22%3A102686%7D")
```

```{r}
opq(bbox = 'Boston MA USA') %>%
  add_osm_feature(key = 'highway') %>%
  osmdata_xml(file = 'OTP/graphs/default/boston_streets.osm')
```

```{r}
ggplot(boston_streets) +
  geom_sf() +
  theme_map()
```
```{r}
path_data <- file.path(getwd(), "OTP")
path_otp <- paste(path_data, "otp.jar",sep = "/")

otp_build_graph(otp = path_otp, dir = path_data, memory = 1024) 
```
```{r}
otp_setup(otp = path_otp, dir = path_data, memory =1024)
```
```{r}
otpcon <- otp_connect()
```
```{r}
iso_5min_walk <- 
  otp_isochrone(otpcon = otpcon, fromPlace = bos_police, 
                mode = "WALK", cutoffSec = 300) %>%
  st_transform(crs = MA_state_plane) %>%
  mutate(mode = "walk")

iso_5min_drive <- 
  otp_isochrone(otpcon = otpcon, fromPlace = bos_police, 
                mode = "CAR", cutoffSec = 300) %>%
  st_transform(crs = MA_state_plane) %>%
  mutate(mode = "drive")

iso_all_modes <- rbind(iso_5min_drive, iso_5min_walk)

otp_stop()
```

```{r}
right_side <- st_bbox(iso_all_modes)$xmax
left_side  <- st_bbox(iso_all_modes)$xmin
top_side <- st_bbox(iso_all_modes)$ymax
bottom_side <- st_bbox(iso_all_modes)$ymin

ggplot(iso_all_modes) +
  annotation_map_tile(zoomin = 0, progress = "none") +
  geom_sf(aes(fill = mode), alpha = 0.5) +
  geom_sf(data = bos_police) +
  coord_sf(xlim = c(left_side, right_side), 
           ylim = c(bottom_side, top_side), expand = FALSE) +
  scale_fill_viridis_d(name = "Area that is reachable within 5 minutes",
                       labels = c("By car", "By foot")) +
  theme_map() +
  labs(caption = "Basemap Copyright OpenStreetMap contributors")
```

